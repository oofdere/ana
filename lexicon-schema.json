{
  "type": "object",
  "properties": {
    "$schema": { "type": "string" },
    "lexicon": { "type": "number", "const": 1 },
    "id": { "type": "string" },
    "revision": { "type": "number" },
    "description": { "type": "string" },
    "defs": {
      "type": "object",
      "additionalProperties": {
        "anyOf": [
          {
            "type": "object",
            "properties": {
              "type": { "type": "string", "const": "record" },
              "description": { "type": "string" },
              "key": { "type": "string" },
              "record": {
                "type": "object",
                "properties": {
                  "type": { "type": "string", "const": "object" },
                  "description": { "type": "string" },
                  "required": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "nullable": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "properties": {
                    "type": "object",
                    "additionalProperties": {
                      "anyOf": [
                        {
                          "anyOf": [
                            {
                              "type": "object",
                              "properties": {
                                "type": { "type": "string", "const": "ref" },
                                "description": { "type": "string" },
                                "ref": { "type": "string" }
                              },
                              "required": ["type", "ref"],
                              "additionalProperties": false
                            },
                            {
                              "type": "object",
                              "properties": {
                                "type": { "type": "string", "const": "union" },
                                "description": { "type": "string" },
                                "refs": {
                                  "type": "array",
                                  "items": { "type": "string" }
                                },
                                "closed": { "type": "boolean" }
                              },
                              "required": ["type", "refs"],
                              "additionalProperties": false
                            }
                          ]
                        },
                        {
                          "anyOf": [
                            {
                              "type": "object",
                              "properties": {
                                "type": { "type": "string", "const": "bytes" },
                                "description": { "type": "string" },
                                "maxLength": { "type": "number" },
                                "minLength": { "type": "number" }
                              },
                              "required": ["type"],
                              "additionalProperties": false
                            },
                            {
                              "type": "object",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "const": "cid-link"
                                },
                                "description": { "type": "string" }
                              },
                              "required": ["type"],
                              "additionalProperties": false
                            }
                          ]
                        },
                        {
                          "type": "object",
                          "properties": {
                            "type": { "type": "string", "const": "array" },
                            "description": { "type": "string" },
                            "items": {
                              "anyOf": [
                                {
                                  "anyOf": [
                                    {
                                      "type": "object",
                                      "properties": {
                                        "type": {
                                          "type": "string",
                                          "const": "boolean"
                                        },
                                        "description": { "type": "string" },
                                        "default": { "type": "boolean" },
                                        "const": { "type": "boolean" }
                                      },
                                      "required": ["type"],
                                      "additionalProperties": false
                                    },
                                    {
                                      "type": "object",
                                      "properties": {
                                        "type": {
                                          "type": "string",
                                          "const": "integer"
                                        },
                                        "description": { "type": "string" },
                                        "default": { "type": "integer" },
                                        "minimum": { "type": "integer" },
                                        "maximum": { "type": "integer" },
                                        "enum": {
                                          "type": "array",
                                          "items": { "type": "integer" }
                                        },
                                        "const": { "type": "integer" }
                                      },
                                      "required": ["type"],
                                      "additionalProperties": false
                                    },
                                    {
                                      "type": "object",
                                      "properties": {
                                        "type": {
                                          "type": "string",
                                          "const": "string"
                                        },
                                        "format": {
                                          "type": "string",
                                          "enum": [
                                            "datetime",
                                            "uri",
                                            "at-uri",
                                            "did",
                                            "handle",
                                            "at-identifier",
                                            "nsid",
                                            "cid",
                                            "language"
                                          ]
                                        },
                                        "description": { "type": "string" },
                                        "default": { "type": "string" },
                                        "minLength": { "type": "integer" },
                                        "maxLength": { "type": "integer" },
                                        "minGraphemes": { "type": "integer" },
                                        "maxGraphemes": { "type": "integer" },
                                        "enum": {
                                          "type": "array",
                                          "items": { "type": "string" }
                                        },
                                        "const": { "type": "string" },
                                        "knownValues": {
                                          "type": "array",
                                          "items": { "type": "string" }
                                        }
                                      },
                                      "required": ["type"],
                                      "additionalProperties": false
                                    },
                                    {
                                      "type": "object",
                                      "properties": {
                                        "type": {
                                          "type": "string",
                                          "const": "unknown"
                                        },
                                        "description": { "type": "string" }
                                      },
                                      "required": ["type"],
                                      "additionalProperties": false
                                    }
                                  ]
                                },
                                {
                                  "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/1"
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "blob"
                                    },
                                    "description": { "type": "string" },
                                    "accept": {
                                      "type": "array",
                                      "items": { "type": "string" }
                                    },
                                    "maxSize": { "type": "number" }
                                  },
                                  "required": ["type"],
                                  "additionalProperties": false
                                },
                                {
                                  "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/0"
                                }
                              ]
                            },
                            "minLength": { "type": "integer" },
                            "maxLength": { "type": "integer" }
                          },
                          "required": ["type", "items"],
                          "additionalProperties": false
                        },
                        {
                          "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/items/anyOf/2"
                        },
                        {
                          "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/items/anyOf/0"
                        }
                      ]
                    }
                  }
                },
                "required": ["type", "properties"],
                "additionalProperties": false
              }
            },
            "required": ["type", "record"],
            "additionalProperties": false
          },
          {
            "type": "object",
            "properties": {
              "type": { "type": "string", "const": "query" },
              "description": { "type": "string" },
              "parameters": {
                "type": "object",
                "properties": {
                  "type": { "type": "string", "const": "params" },
                  "description": { "type": "string" },
                  "required": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "properties": {
                    "type": "object",
                    "additionalProperties": {
                      "anyOf": [
                        {
                          "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/items/anyOf/0"
                        },
                        {
                          "type": "object",
                          "properties": {
                            "type": {
                              "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/type"
                            },
                            "description": {
                              "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/description"
                            },
                            "items": {
                              "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/items/anyOf/0"
                            },
                            "minLength": {
                              "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/minLength"
                            },
                            "maxLength": {
                              "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/maxLength"
                            }
                          },
                          "required": ["type", "items"],
                          "additionalProperties": false
                        }
                      ]
                    }
                  }
                },
                "required": ["type", "properties"],
                "additionalProperties": false
              },
              "output": {
                "type": "object",
                "properties": {
                  "description": { "type": "string" },
                  "encoding": { "type": "string" },
                  "schema": {
                    "anyOf": [
                      {
                        "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/0"
                      },
                      {
                        "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record"
                      }
                    ]
                  }
                },
                "required": ["encoding"],
                "additionalProperties": false
              },
              "errors": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": { "type": "string" },
                    "description": { "type": "string" }
                  },
                  "required": ["name"],
                  "additionalProperties": false
                }
              }
            },
            "required": ["type"],
            "additionalProperties": false
          },
          {
            "type": "object",
            "properties": {
              "type": { "type": "string", "const": "procedure" },
              "description": { "type": "string" },
              "parameters": {
                "$ref": "#/properties/defs/additionalProperties/anyOf/1/properties/parameters"
              },
              "input": {
                "$ref": "#/properties/defs/additionalProperties/anyOf/1/properties/output"
              },
              "output": {
                "$ref": "#/properties/defs/additionalProperties/anyOf/1/properties/output"
              },
              "errors": {
                "type": "array",
                "items": {
                  "$ref": "#/properties/defs/additionalProperties/anyOf/1/properties/errors/items"
                }
              }
            },
            "required": ["type"],
            "additionalProperties": false
          },
          {
            "type": "object",
            "properties": {
              "type": { "type": "string", "const": "subscription" },
              "description": { "type": "string" },
              "parameters": {
                "$ref": "#/properties/defs/additionalProperties/anyOf/1/properties/parameters"
              },
              "message": {
                "type": "object",
                "properties": {
                  "description": { "type": "string" },
                  "schema": {
                    "anyOf": [
                      {
                        "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/0"
                      },
                      {
                        "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record"
                      }
                    ]
                  }
                },
                "additionalProperties": false
              },
              "errors": {
                "type": "array",
                "items": {
                  "$ref": "#/properties/defs/additionalProperties/anyOf/1/properties/errors/items"
                }
              }
            },
            "required": ["type"],
            "additionalProperties": false
          },
          {
            "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/items/anyOf/2"
          },
          {
            "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2"
          },
          {
            "type": "object",
            "properties": {
              "type": { "type": "string", "const": "token" },
              "description": { "type": "string" }
            },
            "required": ["type"],
            "additionalProperties": false
          },
          {
            "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record"
          },
          {
            "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/items/anyOf/0/anyOf/0"
          },
          {
            "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/items/anyOf/0/anyOf/1"
          },
          {
            "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/items/anyOf/0/anyOf/2"
          },
          {
            "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/1/anyOf/0"
          },
          {
            "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/1/anyOf/1"
          },
          {
            "$ref": "#/properties/defs/additionalProperties/anyOf/0/properties/record/properties/properties/additionalProperties/anyOf/2/properties/items/anyOf/0/anyOf/3"
          }
        ]
      }
    }
  },
  "required": ["lexicon", "id", "defs"],
  "additionalProperties": false,
  "$schema": "http://json-schema.org/draft-07/schema#"
}
